<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CS3300 Project 1</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!--<script src="geoMobility.js"></script>-->
</head>
<body>

<script>
    function geographicalMobilityGraph() {
        d3.csv("geoMobilityData2015.csv", function(error, data) {
            var geoDiv = d3.select("#geographicalMobility");

            geoDiv.append("svg")
                .attr("id", "geographicalMobilityPlot")
                .attr("width", 700)
                .attr("height", 600);

            var svg = d3.select("#geographicalMobilityPlot");

            var filter = svg.append("defs")
                .append("filter")
                .attr("id", "f6")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", "200%")
                .attr("height", "200%");

            filter.append("feOffset")
                .attr("result", "offOut")
                .attr("in", "SourceAlpha")
                .attr("dx", 3)
                .attr("dy", 3);

            filter.append("feGaussianBlur")
                .attr("result", "blurOut")
                .attr("in", "offOut")
                .attr("stdDeviation", 2);

            filter.append("feBlend")
                .attr("in", "SourceGraphic")
                .attr("in2", "blurOut")
                .attr("mode", "normal");

            var categories = ["Never Married", "Married", "Divorced", "Separated", "Widowed"];
            var xScale = d3.scaleOrdinal().domain(categories).range([160, 280, 400, 520, 640]);
            var yScale = d3.scaleLinear().domain([0, 5, 30, 100]).range([500, 400, 260, 60]);

            var xAxis = d3.axisBottom(xScale).ticks(5).tickSize(-440).tickPadding(30);
            var yAxis = d3.axisLeft(yScale).tickSize(-600);

            var yNode = svg.append("g")
                .attr("class", "axisWhite")
                .call(xAxis)
                .attr("transform", "translate(0, 500)");

            yNode.select('path')
                .style("stroke", "#ffffff")
                .style("stroke-opacity", "0.15");

            svg.append("line")
                .attr("x1",700)
                .attr("x2",700)
                .attr("y1",500)
                .attr("y2",60)
                .style("stroke", "#ffffff")
                .style("stroke-width","0.8px");

            svg.append("g")
                .attr("class", "axisWhite")
                .call(yAxis)
                .attr("transform", "translate(100, 0)");

            svg.append("text")
                .text("Percentage of People Who Moved Homes From 2014 to 2015")
                .attr("alignment-baseline", "middle")
                .attr("fill", "white")
                .attr("transform", "translate(200, 40)");

            svg.append("text")
                .text("Percentage")
                .attr("alignment-baseline", "middle")
                .attr("fill", "white")
                .attr("transform", "translate(55, 330), rotate(-90)");

            var categoryTotals = [];
            categoryTotals.push(data[0]["Estimate; Total: - Never married"]);
            categoryTotals.push(data[0]["Estimate; Total: - Now married, except separated"]);
            categoryTotals.push(data[0]["Estimate; Total: - Divorced"]);
            categoryTotals.push(data[0]["Estimate; Total: - Separated"]);
            categoryTotals.push(data[0]["Estimate; Total: - Widowed"]);

            var lineColors = ["#B2EF75", "#91D865", "#6CC1C0", "#4898B5", "#276099"];
            var pathGenerator = d3.line()
                .x(function(d, i) { return xScale(i + 1); })
                .y(function(d) { return yScale(d); });

            drawIcons(svg, xScale, yScale, data, pathGenerator, categoryTotals, lineColors[0],
                "Estimate; Total: - Same house 1 year ago:",
                "svgIcons/home_36px.svg");
            drawIcons(svg, xScale, yScale, data, pathGenerator, categoryTotals, lineColors[1],
                "Estimate; Total: - Moved within same county:",
                "svgIcons/bike_36px.svg");
            drawIcons(svg, xScale, yScale, data, pathGenerator, categoryTotals, lineColors[2],
                "Estimate; Total: - Moved from different county within same state:",
                "svgIcons/car_36px.svg");
            drawIcons(svg, xScale, yScale, data, pathGenerator, categoryTotals, lineColors[3],
                "Estimate; Total: - Moved from different state:",
                "svgIcons/train_36px.svg");
            drawIcons(svg, xScale, yScale, data, pathGenerator, categoryTotals,lineColors[4],
                "Estimate; Total: - Moved from abroad:",
                "svgIcons/airplane_36px.svg");
        });
    }

    function filterData(data, filterValue, totals) {
        var percentages = [];
        var i = 0;
        for (var key in data[0]) {
            if (key.includes(filterValue)) {
                percentages.push(data[0][key]/totals[i]*100);
                i++;
            }
        }
        return percentages;
    }

    function drawIcons(svg, xScale, yScale, data, pathGenerator, totals, lineColor, filterValue, imageLink) {
        var percentages = filterData(data, filterValue + " - ", totals);
        console.log(percentages);

        svg.append("path")
            .attr("d", pathGenerator(percentages))
            .attr("fill", "none")
            .attr("stroke", lineColor)
            .attr("stroke-width", 3)
            .style("stroke-dasharray", ("3, 3"))
            .style("filter", "url(#f6)");

        var icons = svg.append("g").selectAll("image").data(percentages);
        icons.enter()
            .append("svg:image")
            .merge(icons)
            .attr("xlink:href", imageLink)
            .attr("x", function(d, i) { return xScale(i + 1) - 24; })  // Subtract 24 to center the icons
            .attr("y", function(d) { return yScale(d) - 24; })
            .style("filter", "url(#f6)");
    }
</script>


<div class = "row-1">
    <div class="header">
       Marital Status Report
    </div>
    <div class="header-content-first">
        <div class="header-content">
            <p>
                How much do you know about marriage and divorce? Over the years, it has been said that marriage and divorce rates have been dropping (see <a href="https://www.washingtonpost.com/news/wonk/wp/2015/06/23/144-years-of-marriage-and-divorce-in-the-united-states-in-one-chart/?utm_term=.4196e2c69a00">this article</a> for more information). We decided to investigate and see for ourselves whether this is true! We found data from the <a href="https://www.census.gov/">United States Census Bureau</a> that provided data for several attributes related to marital status from 2009-2015. We break apart this data in the next few graphs. We'll first describe the various marital categories we examined, and then we'll talk about how they relate to yearly trends, age, race, region, and geographical mobility. Here we go!
            </p>
            
            <div class="row-0">
                <div class="row-0-title">
                    Marital Status Categories
                </div>
                <div class="row-0-legend">
                    <div class="row-0-img">
                        <img src="maritalIcons/in-love.svg" alt="Never Married Icon" />
                    </div>
                    <div class="row-0-content">
                        <b>Never Married:</b> Includes all people who have never been married. Also includes people whose only marriage(s) was annulled.
                    </div>
                </div>

                <div class="row-0-legend">
                    <div class="row-0-img">
                        <img src="maritalIcons/newlyweds.svg" alt="Married Icon" />
                    </div>
                    <div class="row-0-content">
                        <b>Married:</b> Includes people who are currently married, even if they were previously divorced or widowed. Separated couples do not count. If appropriate, this may also include couples who live together or are in common-law marriages.
                    </div>
                </div>
                <div class="row-0-legend">
                    <div class="row-0-img">
                          <img src="maritalIcons/broken-heart-.svg" alt="Divorced Icon" />
                    </div>
                    <div class="row-0-content">
                        <b>Divorced:</b> Includes people who are legally divorced and who have not remarried. Those without a final divorce decree are classified as “separated.”
                    </div>
                </div>

                <div class="row-0-legend">
                    <div class="row-0-img">
                         <img src="maritalIcons/quarrel.svg" alt="Separated Icon" />
                    </div>
                    <div class="row-0-content">
                       <b>Separated:</b> Includes people legally separated or otherwise absent from their spouse because of marital discord. Those without a final divorce decree are classified as “separated.” This category also includes people who have been deserted or who have parted because they no longer want to live together, but who have not obtained a divorce.
                    </div>
                </div>

                <div class="row-0-legend">
                    <div class="row-0-img">
                         <img src="maritalIcons/halloween-gravestone.svg" alt="Widowed Icon" />
                    </div>
                    <div class="row-0-content">
                        <b>Widowed:</b> Includes people who have not remarried after their spouses passed away.
                    </div>
                </div>

             <div class="row-0-legend">
                <p>Now that you know how each category is defined, let's go compare it to other stuff!</p>
             </div>
            </div>
        </div>
          
        <div class="student-list">
            <div class="student-row">
                <div class="student-list-img">
                    <img class="img-circle" src="img/jean.jpg">
                </div>
                <div class="student-list-name">
                    Jean Hooi Lee - MS Computer Science
                </div>

            </div>
            <br>
            <div class="student-row">
                <div class="student-list-img">
                    <img class="img-circle" src="img/ming.jpg">
                </div>
                <div class="student-list-name">
                    Ming Yang - MPS Information Science
                </div>
            </div>
            <br>
            <div class="student-row">
                <div class="student-list-img">
                    <img class="img-circle" src="img/hao.jpg">
                </div>
                <div class="student-list-name">
                    Hao Rong - MS Regional Science
                </div>
            </div>
        </div>
    </div>
</div>
    
<div style="height: 200px;" >
</div>


<div class="polaroid">
    <svg width="960" height="500" style="background: #7b53fc" id="basedOnYear"></svg>
</div>


<div class="row-2">
    <div class="row-2-title" >
        Marital Status by Year
    </div>
    <div class="row-2-content">
        <p>
           In the past six years, we can see that there has been little change in any of the five categories. If we want to be nitpicky, there is a slight upward trend visible in the number of unmarried people (about a 2% change from 2009-2015 out of a population of about 255,421,235 people in the United States). This is actually consistent with the article about how the marriage rate is decreasing, so we confirmed something!
        </p>
        <p>
            Now, let's find out at what age people get married! We will use the most recent 2015 data to do this.
        </p>
    </div>
</div>

<div style="height: 100px; background-color: white; z-index: -2" >
</div>


<div class="row-3">
    <div class="row-3-left">
        <img src="img/mars.png" id="mars">
    </div>
    <div class="row-3-right">
        <img class="rotate45" src="img/femenine.png" id="femenine">
    </div>
</div>

<div>
    <div class="polaroid-2-left">
        <svg width="450" height="280" style="background: #5c50fc" id="basedOnMale"></svg>
    </div>

    <div class="polaroid-2-right">
        <svg width="450" height="280" style="background: #e95efc" id="basedOnFemale"></svg>
    </div>
</div>

<div class="row-4-blank-content">

</div>

<div class="row-4-content">
    <div class="row-4-title2">
        Marital Status by Age
    </div>
    <div class="row-4-content2">
        <p>
            Looking at the "Never Married" category for both men and women, we can see that the trends are nearly identical from ages 15-44 - most are single in their teenage years, about 30% have been married at some point from ages 20-34, and the majority of people have gotten married by ages 35-44. The divergence appears starting around ages 45-54, where women begin to show a higher percentage of being widowed. By the time both genders are 65+, if you take a look at the red dot, 70.4% of men are married, while only 42.6% of women are. 37.3% of women are widowed compared to 12.2% of men. It appears that men are dying earlier than women!
        </p>
        <p>
           How about ethnicity/race? How does that play a role in marriage and divorce? Let's go see!
        </p>
    </div>
</div>

<div class="row-4">

</div>

<div class="row-5">
    <div class="race-row">
        <div class="race-row-img">
            <img src="img/race1.png" class="img-circle-1">
            <img src="img/race2.png" class="img-circle-2">
            <img src="img/race3.png" class="img-circle-3">
            <img src="img/race4.png" class="img-circle-4">
            <img src="img/race5.png" class="img-circle-5">
            <!--<a id="race-row-title">-->
                Marital Status by Ethnicity
            <!--</a>-->
        </div>
    </div>
    <div class="race-content">
        <p style="padding-top: 10px">
            We don't mean to sound racist here, so please don't be offended by whatever we say! 
        </p>
        <p>
            It seems that if you're Asian, among your Asian peers, you had a higher likelihood of being married in 2015 than anything else. This trend was very similar for Caucasians as well. On the other hand, if you are African American, you were most likely to be unmarried amongst your African American peers. If you are Hispanic, we would all have to guess your marital status, since you had a relatively equal likelihood of being married or unmarried! As for divorce, not only were Asians the most likely to be married, but they have the lowest rate of divorce! Yay for marital bliss!
        </p>
        <p>
            Now, let's talk about where the married people are. On to the maps!
        </p>
    </div>

</div>

<div class="polaroid-3">
    <svg width="960" height="570" id="basedOnRace" style="background: #7b53fc" ></svg>
</div>

<div class="row-6">

</div>

<div class="polaroid-4">
    <svg class="geo" width="350" height="270">
        <switch>
            <foreignObject x="0" y="-10" width="350" height="270">
                <p class="geo-text" style="text-align: left; color: white;  padding: 10px 10px 0px 10px;">The midwest appears to have a relatively higher married rate compared to all other regions (northeast, south, and west). The coastal areas and region near Great Lakes have relatively higher unmarried rates. This might be because there is a higher population density in these areas. The separated, divorced, and widowed rates are higher in the southeast. The divorce rate is also higher in the west compared to other parts of the country.</p>
                <p class="geo-text" style="text-align: left; color: white;  padding: 5px 10px 0px 10px;">Washington D.C. is an extreme outlier on the map with both the highest unmarried rate and the lowest married rate, but it can hardly be recognized in the map.</p>
            </foreignObject>
        </switch>
    </svg>
    <svg class="geo" width="350" height="270" id="svgNev"></svg>
    <svg class="geo" width="350" height="270" id="svgMar"></svg>
    <svg class="geo" width="350" height="270" id="svgDiv"></svg>
    <svg class="geo" width="350" height="270" id="svgSep"></svg>
    <svg class="geo" width="350" height="270" id="svgWid"></svg>






    
    <script>
        var svgMar = d3.select("#svgMar");
        var svgNev = d3.select("#svgNev");
        var svgWid = d3.select("#svgWid");
        var svgDiv = d3.select("#svgDiv");
        var svgSep = d3.select("#svgSep");
        var projection = d3.geoAlbersUsa().scale(75);
        var pathGenerator = d3.geoPath().projection(projection);


        var sColor = "#ffffff";
        var eMarColor = "#E85C5C";
        var eNevColor = "#0089F2";
        var eWidColor = "#E57A2D";
        var eDivColor = "#84D82B";
        var eSepColor = "#F2D30E";

        var marriedColors = [sColor, eMarColor];
        var neverColors = [sColor, eNevColor];
        var widowedColors = [sColor, eWidColor];
        var divorcedColors = [sColor, eDivColor];
        var separatedColors = [sColor, eSepColor];

        var marriedScale = d3.scaleLinear().domain([27, 57]).range(marriedColors);
        var neverScale = d3.scaleLinear().domain([26, 57]).range(neverColors);
        var widowedScale = d3.scaleLinear().domain([3, 8]).range(widowedColors);
        var divorcedScale = d3.scaleLinear().domain([8, 15]).range(divorcedColors);
        var separatedScale = d3.scaleLinear().domain([0, 3.5]).range(separatedColors);


        var states;
        var usMarital;

        // function to handle any row-by-row processing on CSV
        var parseRow = function(row) {
            row.Id = Number(row.Id);
            return row;
        };

        d3.queue()
            .defer(d3.json, "us.json")
            .defer(d3.csv, "Geographic_marital_data.csv", parseRow)
            .await(function (error, rawMap, rawMarital) {

                states = topojson.feature(rawMap, rawMap.objects.states);

                usMarital = d3.map(rawMarital, function (d) {
                    return d.Id;
                });

                console.log(usMarital);

                showMap(svgMar, marriedScale, "NowMarried","Now Married Rate");
                showMap(svgNev, neverScale, "NeverMarried","Never Married Rate");
                showMap(svgWid, widowedScale, "Widowed","Widowed Rate");
                showMap(svgDiv, divorcedScale, "Divorced","Divorced Rate");
                showMap(svgSep, separatedScale, "Separated","Separated Rate");

                showGradient(svgMar,sColor,eMarColor,1,"27.3%","56.1%");
                showGradient(svgNev,sColor,eNevColor,2,"26.4%","56.5%");
                showGradient(svgWid,sColor,eWidColor,3,"3.70%","7.90%");
                showGradient(svgDiv,sColor,eDivColor,4,"8.50%","14.1%");
                showGradient(svgSep,sColor,eSepColor,5,"0.90%","3.30%");

                showDots(svgMar,0.273,0.561,"NowMarried");
                showDots(svgNev,0.264,0.565,"NeverMarried");
                showDots(svgWid,0.037,0.079,"Widowed");
                showDots(svgDiv,0.085,0.141,"Divorced");
                showDots(svgSep,0.009,0.033,"Separated");
            });

        function showDots(svgbox, min, max, variable){
            var dotScale = d3.scaleLinear().domain([min*100, max*100]).range([146, 308]);
            for (var key in usMarital) {
                if (!usMarital.hasOwnProperty(key)) continue;
                var item = usMarital[key];

                if (!item.hasOwnProperty(variable)) continue;
                var xCoordinate = dotScale(item[variable]);

                svgbox.append("circle")
                .attr("cx",xCoordinate)
                .attr("cy",251)
                .attr("r",3)
                .attr("fill","#ffffff")
                .attr("fill-opacity",0.45);
            }
        }

        function showMap(svgbox, scale, variable, title) {

            svgbox.append("text")
            .attr("x",0)
            .attr("y",13)
            .attr("fill","#ffffff")
            .attr("style","font-family: sans-serif; font-size: 16px;")
            .text(title);

            projection.fitExtent([[0,20], [svgbox.attr("width") , svgbox.attr("height") - 30 ]], states);
            pathGenerator = d3.geoPath().projection(projection);

            var paths = svgbox.selectAll("path.state").data(states.features);
            paths.enter().append("path").attr("class", "state")
                .on("click", function (d) { console.log(d.id);})
                .merge(paths)
                .style("fill", function (state) {
                    var stateData = usMarital.get(state.id);

                    if (stateData) {
                        return scale(stateData[variable]);
                    }

                })
                .attr("d", function (state) {
                    return pathGenerator(state);
                });

        }


        function showGradient(svg, sColor, eColor, num, legendStart, legendEnd){
            var svgDefs = svg.append('defs');
            var mainGradient = svgDefs.append('linearGradient').attr('id','mainGradient'+num);
            mainGradient.append('stop').attr("offset","0%").attr("stop-color",sColor);
            mainGradient.append('stop').attr("offset","90%").attr("stop-color",eColor);

            svg.append("rect")
                .attr("x",142)
                .attr("y",258)
                .attr("width",170)
                .attr("height",8)
                .attr("rx", 6)
                .attr("ry", 6)
                .attr("fill","url(#mainGradient"+num+")")
                .attr("fill-opacity","0.6")
                .attr("stroke",sColor)
                .attr("stroke-opacity","0.5");

            svg.append("text")
                .attr("x",106)
                .attr("y",265)
                .attr("fill","#ffffff")
                .attr("style","font-family: sans-serif; font-size: 11px;")
                .text(legendStart)

            svg.append("text")
                .attr("x",318)
                .attr("y",265)
                .attr("fill","#ffffff")
                .attr("style","font-family: sans-serif; font-size: 11px;")
                .text(legendEnd)
        }

    </script>


</div>


<div class="row-7">
    <svg width="1400" height="600" id="row7Background" ></svg>
</div>

<div class="row-8">

</div>


<div class="row-9">
    <div class="row-9-left" id="geographicalMobility">
        <script>

            geographicalMobilityGraph();

        </script>
    </div>

    <div class="row-9-right">
        <div class="row-9-right-title">
            Geographical Mobility
        </div>
        <div class="row-9-right-legend">
            <div class="row-9-right-img">
                <i class="material-icons white md-36">home</i>
            </div>
            <div class="row-9-right-content">
                People who remain in the same house from 1 year ago
            </div>
        </div>

        <div class="row-9-right-legend">
            <div class="row-9-right-img">
                <i class="material-icons white md-36">directions_bike</i>
            </div>
            <div class="row-9-right-content">
                People who moved within the county in the past year
            </div>
        </div>


        <div class="row-9-right-legend">
            <div class="row-9-right-img">
                <i class="material-icons white md-36">directions_car</i>
            </div>
            <div class="row-9-right-content">
                People who moved to a different county within the same state in the past year
            </div>
        </div>

        <div class="row-9-right-legend">
            <div class="row-9-right-img">
                <i class="material-icons white md-36">train</i>
            </div>
            <div class="row-9-right-content">
               People who moved to a different state in the past year
            </div>
        </div>

        <div class="row-9-right-legend">
            <div class="row-9-right-img">
                <i class="material-icons white md-36"><i class="material-icons">local_airport</i></i>

            </div>
            <div class="row-9-right-content">
                People who moved from abroad in the past year
            </div>
        </div>


        <div class="row-9-right-legend">
            <div class="row-9-right-content">
                <p>
                   So we just looked at maps of where people are for each marital status category. Now, how many people are actually moving?
                </p>
                <p>
                   In general, 75-90% of people tend to stay in the same house from year to year. However, those who have never married or who are separated had a tendency to be more mobile from 2014 to 2015. Of those who moved, most stayed near their original homes, moving only within the county. Less than 1% of people in each category have moved from abroad. In the graph on the left, we have greatly enlarged the 0-10% section to make the values of the last three categories easier to compare.
                </p>
                <p>
                    And that's all the data we have for you! So...
                </p>
            </div>
        </div>

    </div>
</div>


<div class="row-10">

</div>

<div class="row-11">
 <div class="row-11-title">
 In Conclusion...
 </div>
    <div class="row-11-content">
        Looking at all the attributes as a whole, we can see that marital status is a complex subject that cannot be defined by any one characteristic. We have examined the categories of "Never Married," "Married," "Divorced," "Separated," and "Widowed" in the context of annual trends, age, gender, ethnicity, region, and geographical mobility. We hope that you have found this report interesting. Thanks for reading!

    </div>
</div>

</body>

<script>

    var background = d3.select("#row7Background");

    function circleTransition(x) {

        var timeCircle = background.append("line")
            .style("stroke", "white")  // colour the line
            .attr("stroke-width", 2)
            .attr("opacity", 0.8)
            .style("stroke-dasharray", ("3, 3"));
        repeat();

        var title = background.append("text")
            .attr("x", 370)
            .attr("y", 50)
            .attr("dy", ".35em")
            .attr("opacity",1)
            .style("font-family", "Open Sans")
            .style("font-size", "20px")
            .style("fill", "white")
            .style("text-anchor", "end")
            .text("Marital Status by State");



        function repeat() {
            timeCircle
                .attr("x1", x)     // x position of the first end of the line
                .attr("y1", 20)      // y position of the first end of the line
                .attr("x2", x)     // x position of the second end of the line
                .attr("y2", 20)   // y position of the second end of the line
                .attr("opacity", 0)
                .transition()        // apply a transition
                .duration(2000)      // apply it over 2000 milliseconds
                .attr("opacity", 0.6)
                .attr("x1", x)     // x position of the first end of the line
                .attr("y1", 20)      // y position of the first end of the line
                .attr("x2", x)     // x position of the second end of the line
                .attr("y2", 800)   // y position of the second end of the line
                .transition()        // apply a transition
                .duration(100)      // apply it over 2000 milliseconds
                .attr('cx', 920)     // move the circle to 920 on the x axis
                .transition()        // apply a transition
                .duration(2000)      // apply it over 2000 milliseconds
                .attr("opacity", 0.0)
                .attr("x1", x)     // x position of the first end of the line
                .attr("y1", 800)      // y position of the first end of the line
                .attr("x2", x)     // x position of the second end of the line
                .attr("y2", 800)

                .on("end", repeat);  // when the transition finishes start again
        };

    };

    function circleTransitionH(y) {

        var timeCircle = background.append("line")
            .style("stroke", "white")  // colour the line
            .attr("stroke-width", 2)
            .attr("opacity", 0.8)
            .style("stroke-dasharray", ("3, 3"));
        repeat();

        function repeat() {
            timeCircle
                .attr("x1", 30)     // x position of the first end of the line
                .attr("y1", y)      // y position of the first end of the line
                .attr("x2", 30)     // x position of the second end of the line
                .attr("y2", y)   // y position of the second end of the line
                .attr("opacity", 0)
                .transition()        // apply a transition
                .duration(2000)      // apply it over 2000 milliseconds
                .attr("opacity", 0.6)
                .attr("x1", 30)     // x position of the first end of the line
                .attr("y1", y)      // y position of the first end of the line
                .attr("x2", 1400)     // x position of the second end of the line
                .attr("y2", y)   // y position of the second end of the line
                .transition()        // apply a transition
                .duration(100)      // apply it over 2000 milliseconds
                .attr('cx', 920)     // move the circle to 920 on the x axis
                .transition()        // apply a transition
                .duration(2000)      // apply it over 2000 milliseconds
                .attr("opacity", 0.0)
                .attr("x1", 1400)     // x position of the first end of the line
                .attr("y1", y)      // y position of the first end of the line
                .attr("x2", 1400)     // x position of the second end of the line
                .attr("y2", y)

                .on("end", repeat);  // when the transition finishes start again
        };

    };

    circleTransition(180);
    circleTransition(340);
    circleTransition(500);
    circleTransition(660);
    circleTransition(820);
    circleTransition(980);
    circleTransition(1140);
    circleTransition(1300);
    circleTransitionH(50);
    circleTransitionH(250);
    circleTransitionH(450);
</script>



<script>
    var basedOnYear = d3.select("#basedOnYear");
    var margin = {top: 40, right: 20, bottom: 40, left: 60};
    var width = basedOnYear.attr("width") - margin.left - margin.right;
    var height = basedOnYear.attr("height") - margin.top - margin.bottom;
    var xScale1 = d3.scaleBand().range([0, width ]).paddingInner(1);
    var yScale1 = d3.scaleLinear().range([height, 0]).domain([0,100]);
    var colorScale = d3.scaleOrdinal(["#B2EF75", "#91D865", "#6CC1C0", "#4898B5", "#276099"]);

    var stack = d3.stack();

    var area1 = d3.area()
        .x(function (d,i) {
            return xScale1(d.data.date);
        })
        .y0(function(d) {  return yScale1(d[0]); })
        .y1(function(d) {  return yScale1(d[1]); });
    
    basedOnYear.append("text")
            .text("Marital Status by Year")
            .attr("alignment-baseline", "middle")
            .attr("fill", "white")
            .attr("transform", "translate("+(width/2-margin.left/4)+", "+(margin.top/2)+")");
        
    basedOnYear.append("text")
            .text("Percentage")
            .attr("alignment-baseline", "middle")
            .attr("fill", "white")
            .attr("transform", "translate("+(margin.left/8)+", "+(3*height/4)+"), rotate(-90)");

    basedOnYear.append("text")
            .text("Year")
            .attr("alignment-baseline", "middle")
            .attr("stroke", "white")
            .attr("transform", "translate("+(width/2+3*margin.left/4)+", "+(height + 7*margin.bottom/4)+")");
    
    var g1 = basedOnYear.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.tsv("yearData.tsv", function (error, data) {
        if (error) throw error;
        var keys = data.columns.slice(1);


        xScale1.domain(data.map(function(d) { return d.date; }));

        colorScale.domain(keys);
        stack.keys(keys);

        var layer1 = g1.selectAll(".layer")
            .data(stack(data))
            .enter().append("g")
            .attr("class", "layer1");

        layer1.append("path")
            .attr("class", "area")
            .style("fill", function(d) { return colorScale(d.key); })
            .attr("d", area1);

        var temp = [];

        layer1.filter(function(d) { return d[d.length - 1][1] - d[d.length - 1][0] > 0.01; })
            .append("text")
            .attr("x", width - 6)
            .attr("y", function(d) { temp.push(d[d.length - 1][1]); return yScale1((d[d.length - 1][0] + d[d.length - 1][1]) / 2); })
            .attr("dy", ".35em")
            .style("font", "12px sans-serif")
            .style("fill", "white")
            .style("text-anchor", "end")
            .text(function(d) {return d.key; });

        var temp = [];
        stack(data).forEach(function (d) {
            temp.push(d);
        });

        for (var i = 0; i < data.length; i++) {
            for (var j = 0; j < temp.length; j++) {

                g1.append("circle")
                    .attr("id", "c"+i+j)

                    .attr("cx", xScale1(data[i].date))
                    .transition().delay(400).duration(1300)
                    .attr("cy", yScale1(temp[j][i][1]))
                    .attr("r", 6)
                    .attr("stroke", "#7b53fc")
                    .attr("stroke-width", 1)
                    .attr("opacity", 0.9)
                    .attr("fill", "white");

            }
        }

        for (var i = 0; i < data.length; i++) {
            g1.append("line")          // attach a line
                .style("stroke", "white")  // colour the line
                .attr("id","line")
                .attr("stroke-width", 2)
                .attr("opacity", 0.8)
                .style("stroke-dasharray", ("3, 3"))
                .attr("x1", xScale1(data[i].date))     // x position of the first end of the line
                .attr("y1", yScale1(0))      // y position of the first end of the line
                .attr("x2", xScale1(data[i].date))     // x position of the second end of the line
                .attr("y2", yScale1(0));    // y position of the second end of the line
        }

        d3.selectAll("#line")
            .transition().delay(700).duration(1300)
            .attr("y2", yScale1(100));


        g1.append("g")
            .attr("class", "axis axis--x axisWhite")
            .attr("transform", "translate(0," + height + ")")

            .call(d3.axisBottom(xScale1))
            .attr("color", "white");

        g1.append("g")
            .attr("class", "axis axis--y axisWhite")
            .call(d3.axisLeft(yScale1).ticks(10));


    });

</script>


<script>

    smallChart("basedOnMale");
    smallChart("basedOnFemale");


    function smallChart(id) {
        var basedOnMale = d3.select("#"+id);
        var margin2 = {top: 30, right: 20, bottom: 40, left: 50};
        var width2 = basedOnMale.attr("width") - margin2.left - margin2.right;
        var height2 = basedOnMale.attr("height") - margin2.top - margin2.bottom;


        var xScale = d3.scaleBand().range([0, width2 ]).paddingInner(1);
        var yScale = d3.scaleLinear().range([height2, 0]).domain([0,100]);
        var colorScale = d3.scaleOrdinal(["#B2EF75", "#91D865", "#6CC1C0", "#4898B5", "#276099"]);
        
        var stack = d3.stack();

        var area = d3.area()
            .x(function (d,i) {
                return xScale(d.data.Range);
            })
            .y0(function(d) {  return yScale(d[0]); })
            .y1(function(d) {  return yScale(d[1]); });

        basedOnMale.append("text")
            .text("Marital Status by Age")
            .attr("alignment-baseline", "middle")
            .attr("stroke", "white")
            .attr("transform", "translate("+(width2/4+3*margin2.left/2)+", "+(margin2.top/2)+")");
        
        basedOnMale.append("text")
                .text("Percentage")
                .attr("alignment-baseline", "middle")
                .attr("stroke", "white")
                .attr("transform", "translate("+(margin2.left/4)+", "+(3*height2/4+3*margin2.top/4)+"), rotate(-90)");
        
        basedOnMale.append("text")
                .text("Age")
                .attr("alignment-baseline", "middle")
                .attr("stroke", "white")
                .attr("transform", "translate("+(width2/2+3*margin2.left/4)+", "+(height2 + 3*margin2.bottom/2)+")");
        
        var g2 = basedOnMale.append("g")
            .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

        d3.tsv(id+".tsv", function (error, data) {
            if (error) throw error;
            var keys = data.columns.slice(1);


            xScale.domain(data.map(function(d) { return d.Range; }));

            colorScale.domain(keys);
            stack.keys(keys);

            var layer2 = g2.selectAll(".layer")
                .data(stack(data))
                .enter().append("g")
                .attr("class", "layer2");

            layer2.append("path")
                .attr("class", "area")
                .style("fill", function(d) { return colorScale(d.key); })
                .attr("d", area);

            var temp = [];

            layer2.filter(function(d) { return d[d.length - 1][1] - d[d.length - 1][0] > 0.01; })
                .append("text")
                .attr("x", width2 - 6)
                .attr("y", function(d) { temp.push(d[d.length - 1][1]); return yScale((d[d.length - 1][0] + d[d.length - 1][1]) / 2); })
                .attr("dy", ".35em")
                .style("font", "12px sans-serif")
                .style("fill", "white")
                .style("text-anchor", "end")
                .text(function(d) {return d.key; });


            var temp = [];
            stack(data).forEach(function (d) {

                temp.push(d);

            });



            for (var i = 0; i < data.length; i++) {
                for (var j = 0; j < temp.length; j++) {
                   
                    var color = "white";
                    
                    if (i == 5 && j == 1) {
                        color = "red";
                    }
                    
                    g2.append("circle")
                        .attr("id", "c"+i+j)
                        .attr("cx", xScale(data[i].Range))
                        .transition().delay(400).duration(1300)
                        .attr("cy", yScale(temp[j][i][1]))
                        .attr("r", 6)
                        .attr("stroke", "#7b53fc")
                        .attr("stroke-width", 1)
                        .attr("opacity", 0.9)
                        .attr("fill", color);
                }
            }

            for (var i = 0; i < data.length; i++) {
                g2.append("line")          // attach a line
                    .style("stroke", "white")  // colour the line
                    .attr("id","line")
                    .attr("stroke-width", 2)
                    .attr("opacity", 0.8)
                    .style("stroke-dasharray", ("3, 3"))
                    .attr("x1", xScale(data[i].Range))     // x position of the first end of the line
                    .attr("y1", yScale(0))      // y position of the first end of the line
                    .attr("x2", xScale(data[i].Range))     // x position of the second end of the line
                    .attr("y2", yScale(0));    // y position of the second end of the line
            }

            d3.selectAll("#line")
                .transition().delay(700).duration(1300)
                .attr("y2", yScale(100));

            g2.append("g")
                .attr("class", "axis axis--x axisWhite")
                .attr("transform", "translate(0," + height2 + ")")

                .call(d3.axisBottom(xScale))
                .attr("color", "white");

            g2.append("g")
                .attr("class", "axis axis--y axisWhite")
                .call(d3.axisLeft(yScale).ticks(10));
        });
    }
</script>


<script>
    groupedBarChart();
    function groupedBarChart() {

        var svg = d3.select("#basedOnRace"),
            margin = {top: 40, right: 20, bottom: 100, left: 240},
            width = +svg.attr("width") - margin.left - margin.right,
            height = +svg.attr("height") - margin.top - margin.bottom,
            g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var y0 = d3.scaleBand()
            .rangeRound([0, height])
            .paddingInner(0.1);

        var y1 = d3.scaleBand()
            .padding(0.05);

        var x = d3.scaleLinear()
            .rangeRound([0, width]);

        var z = d3.scaleOrdinal()
            .range(["#B2EF75", "#91D865", "#6CC1C0", "#4898B5", "#276099"]);


        svg.append("text")
            .attr("x",470)
            .attr("y",30)
            .attr("fill","white")
            .text("Marital Status by Ethnicity")
            .style("font-family", "Open Sans")
            .style("font-size", "14px");

        svg.append("rect")
            .attr("width",50)
            .attr("height",10)
            .attr("fill","#B2EF75")
            .attr("x",240)
            .attr("y",530);

        svg.append("text")
            .attr("x",300)
            .attr("y",540)
            .attr("fill","white")
            .text("Never Married")
            .style("font-family", "Open Sans")
            .style("font-size", "14px");

        svg.append("rect")
            .attr("width",50)
            .attr("height",10)
            .attr("fill","#91D865")
            .attr("x",410)
            .attr("y",530);

        svg.append("text")
            .attr("x",470)
            .attr("y",540)
            .attr("fill","white")
            .text("Married")
            .style("font-family", "Open Sans")
            .style("font-size", "14px");

        svg.append("rect")
            .attr("width",50)
            .attr("height",10)
            .attr("fill","#B2EF75")
            .attr("x",540)
            .attr("y",530);


        svg.append("text")
            .attr("x",600)
            .attr("y",540)
            .attr("fill","white")
            .text("Divorced")
            .style("font-family", "Open Sans")
            .style("font-size", "14px");


        svg.append("rect")
            .attr("width",50)
            .attr("height",10)
            .attr("fill","#6CC1C0")
            .attr("x",680)
            .attr("y",530);

        svg.append("text")
            .attr("x",740)
            .attr("y",540)
            .attr("fill","white")
            .text("Separated")
            .style("font-family", "Open Sans")
            .style("font-size", "14px");



        svg.append("rect")
            .attr("width",50)
            .attr("height",10)
            .attr("fill","#276099")
            .attr("x",830)
            .attr("y",530);

        svg.append("text")
            .attr("x",890)
            .attr("y",540)
            .attr("fill","white")
            .text("Widowed")
            .style("font-family", "Open Sans")
            .style("font-size", "14px");


        d3.csv("raceData.tsv", function (d, i, columns) {
            for (var i = 1, n = columns.length; i < n; ++i){
                d[columns[i]] = +d[columns[i]];
            }

            return d;
        }, function (error, data) {
            if (error) throw error;

            var keys = data.columns.slice(1);

            y0.domain(data.map(function(d) { return d.State; }));
            y1.domain(keys).rangeRound([0, y0.bandwidth()]);
            x.domain([0, d3.max(data, function(d) { return d3.max(keys, function(key) { return d[key]; }); })]).nice();



            g.append("g")
                .selectAll("g")
                .data(data)
                .enter().append("g")
                .attr("transform", function(d) { return "translate(0," + y0(d.State) + ")"; })
                .selectAll("rect")
                .data(function(d) { return keys.map(function(key) { return {key: key, value: d[key]}; }); })
                .enter().append("rect")
                .attr("y", function(d) { return y1(d.key); })
                .attr("x", function(d) { return x(0); })
                .attr("height", y1.bandwidth() )
                .attr("width", function(d) { return x(d.value); })
                .attr("fill", function(d) { return z(d.key); }
                );

            g.append("g")
                .attr("class", "axis axisWhite")
                .attr("x", 2)
                .attr("y", x(x.ticks().pop()) + 0.5)
                .attr("dy", "0.32em")
                .attr("fill", "#000")
                .attr("font-weight", "bold")
                .attr("text-anchor", "start")
                .call(d3.axisLeft(y0));

            g.append("g")
                .attr("class", "axis axisWhite")
                .call(d3.axisBottom(x).ticks(null, "s").tickSize(-425))
                .attr("transform", "translate(0," + height + ")")
                .append("text")
                .text("Percentage")
                .attr("x", 350)
                .attr("y", 35);
        });
    }
</script>

<script>

</script>


</html>